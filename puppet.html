<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
 


   
<!--  xhtml format, hw6 (tables) had to use transitional instead of strict dtd.  -->    
<!--
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">


the one below for strict html:
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

sttrict xhtml:

-->





<!--  
CSS Class - UCSCX - 2012.07 - Final Project 
Also making it as part of my PSG page remake.

CSS validator: http://jigsaw.w3.org/css-validator/#validate_by_uri
HTML validator: http://validator.w3.org/
-->    
    
<head>
	<title>Sys Admin Pocket Survival Guide</title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
        <link rel="stylesheet" href="psg2.css"                type="text/css" media="screen">
        <link rel="stylesheet" href="psg-table.css"           type="text/css">
        <link rel="stylesheet" href="psg2-links-icons.css"    type="text/css">
        <link rel="stylesheet" href="psg-positioning.css"     type="text/css">
        <link rel="stylesheet" href="psg-print.css" type="text/css" media="print">
</head>

    
<body>
  <div id="fixie"> <!-- add a fixed position example for css final project.   potentially use to place ad, which will appear like a 3rd column on right -->
          <div id="one"   class="skinny"><a href="plug/plug.html"><img src="plug/nema-5-20R-drawing.gif" alt="nema5pic" width="100" height="100"></a></div>
          <div id="two"   class="skinny"><a href="fig/unixoid_hell.gif"><img src="fig/unixoid_hell.gif"  alt="vi-hell"   width="100" height="77" ></a></div>
          <div id="three" class="skinny"><a href="fig/Assistant.gif"><img    src="fig/Assistant.gif"     alt="clippie"   width="100" height="77" ></a></div>
          <div id="four"  class="skinny"><!-- empty for now --></div>
  </div> <!-- closes #fixie -->

    
<div id="wrapper">
  <div id="header">
    <div id="title">Sys Admin Pocket Survival Guide</div>
    <div id="sub-title">A Quick Reference Guide for Sys Admins with Alzeimer :)</div>
  </div> <!-- closes header -->
  
  <div id="navigation">
      <!-- the replace was not inside hightlight area, but whole page, finc and put back some strong and em in doc...-->
   <!--  strong, em, h5, or div are not allowed to be nested inside ul !!  -->
       <div class="azul">Unix</div>
	<ul>
        <li> <a href="sul>.html">Solaris</a></li>
        <li> <a href="linux.html">Linux</a></li>
        <li> <a href="hpux.html">HP-UX</a> and <br>
                <a href="hpux.supl.html">supplement</a></li>
        <li> <a href="aix.html">AIX</a> and <br>
                <a href="aix_cd_catalog.html">AIX CD catalog</a><br></li>
        <li> <a href="irix.html">Irix</a></li>
        <li> <a href="dos.html">Windows</a></li>
        <li> <a href="apple.html">Apple Mac</a></li>
	</ul>

        <div class="azul">Storage</div>
	<ul>
        <li> <a href="netapp.html">NetApp</a></li>
        <li> <a href="emc.html">EMC SAN - Clariion</a></li>
        <li> <a href="emcCelerra.html">EMC NAS - Celerra</a></li>
        <li> <a href="isilon.html">Isilon</a></li>     
        <li> <a href="fs.html">Unix File System</a></li>
	</ul>

        <div class="azul">Big Data</div>
	<ul>
        <li> <a href="lsf.html">LSF, PBS/Torque, LSF.</a></li>
        <li> <a href="mpi.html">MPI, PVM</a></li>
        <li> <a href="sci-file.html">Science File Format/Info</a></li>
        <li><a href="sci-app.html">Sci-App</a></li>
	</ul>
            
      
        <div class="azul">Unix Dev</div>
	<ul>
  	<li><a href="development.html">compilers, etc</a></li>
  	<li><a href="shellScript.txt">sh/bash, csh/tcsh</a></li>
  	<li><a href="awk.txt">AWK</a></li>
  	<li><a href="perl.html">Perl</a></li>
  	<li><a href="python.html">Python</a></li>
  	<li><a href="php.txt">PHP</a></li>
  	<li><a href="javascript_eg.html">javascript_eg</a></li>
   	<li>gcc</li>
  	<li><a href="gdb.html">gdb</a></li>
   	<li>java</li>
   	<li>rcs, cvs, p4, subversion</li>
	<li><a href="vi.html">vi</a></li> 
	</ul>

        <div class="azul">Network</div>
	<ul>
        <li> <a href="net.html">Network</a></li>
        <li> <a href="infiniband.html">InfiniBand</a><br></li>
        <li> <a href="acopia.html">Acopia</a></li>
	</ul>

        <div class="azul">Misc</div>
	<ul>
        <li> <a href="config_mgmt_comparison.html">configuration management comp
arison</a><BR></li>
        <li> <a href="puppet.html">puppet</a><BR></li>
        <li> <a href="ldap.html">LDAP</a><BR></li>
        <li> <a href="admin.html">General Unix Sys Admin </a></li>
        <li> <a href="tool.html">Sys Admin tools and performance tuning</a></li>
        <li> <a href="vnc.html">VNC, X Emulation</a></li>
        <li> <a href="backup.html">Unix backup</a></li>
        <li> <a href="general_unix.html">Generic Unix Commands</a></li>
        <li> <a href="veritas.html">Veritas</a></li>
        <li> <a href="legato.html">Legato Networker</a></li>
        <li> <a href="mysql.html">MySQL</a></li>
        <li> <a href="html.txt">HTML tags</a></li>
        <li> <a href="wiki.html">WiKi tags</a></li>
        <li> <a href="3rdParty">3rd Party and Vendor Docs Cache</a></li>
	</ul>

        <div class="azul">IMHO</div>
	<ul>
        <li> <a href="monitor.html">Network monitoring tool review</a></li>
        <li> <a href="netArch.html">Network Architecture Approaches</a></li>
        <li> <a href="docPlatform.html">Documentation platform</a></li>
	</ul>

        <div class="azul">Prod Review</div>
	<ul>
        <li><a href="termSvr.html">Terminal (Serial Console) Servers</a></li>
        <li><a href="ent_prod.html">Enterprise Products</a></li>
        <li><a href=""></a></li>
        <li> &nbsp; </li>
	</ul>
            
	<div class="azul">More</div>
	<ul>
	<li><a href="psg1.html">Full TOC</A></li>
	</ul>

  </div> <!-- closes #navigation -->


  <!-- ########################################################## -->
  <!-- ########################################################## -->
  
  <div id="content">

      <p>
  
<H2><div class="azul">PUPPET</div></H2>
<H3>101</H3>
<p>
Host config/management using Puppet specify the "what".  Essentially, simple YAML file to list all the desired settings the host need to have.<br>

modules (puppet preconfig or 3rd party) takes these declarations and create commands that will be executed by the agent.  These typically resides in /etc/puppet/environment/prd/modules/<br>
</p>
<!-- /etc/puppet/environment/dev/modules/common has srv_mongodb, srv_mrepo_proxy srv_vertica etc classes defined by NX, these should define the action of what happens to machine defined in such classes 

there are cases where files are copied verbatim (ie not using ruby syntax, but target rhel machine syntax)  eg:
    from_file => "puppet:///modules/${module_name}/sudo-rules-oracle-rac",

-->

Puppet is based on Ruby.  Dev will likely involve writting snipplet of code based on ruby, and .erb template based on ruby's parsing.
<BR>

<H3>Config</H3>
<OL>
<LI>/etc/puppet/puppet.conf
<LI>/etc/puppet/manifest/site.pp
<LI>
<LI>/etc/puppet/environment/prd/modules/common/  	# classes/group defined here
<LI>/etc/puppet/environment/prd/modules/common/core/manifests/init.pp		# set of common core settings eg default/core packages.
<LI>/etc/puppet/environment/prd/modules/common/srv_oracle/manifests/init.pp	# define the classes, what other modules to include, etc.
<LI>

<LI>/etc/puppet/data/enc/ $fqdn.yaml 			# what class a host is defined into
<LI>

<LI>/etc/puppet/data/hiera/common/common.yaml		# hiera store more variable stuff, users that belong to a class, etc
<LI>/etc/puppet/data/hiera/site/common.yaml		# site specific stuff, like NFS mounts, root pw, 
<LI>/etc/puppet/data/hiera/site/ $fqdn.yaml		# very specific to a given host.  probably little stuff here.  eg specific user that may need sudo access.  host specific mounts.  

<LI>
</OL>



<PRE>
- what goes into ENC and what goes into Hiera??
  * modules dir has .pp files, 
  * hiera has .yaml
Looking at mountfs module, the .pp module files look at the .yaml and loop to add each mounts defined.
it just that the .pp uses lot of puppet construct to effect the changes on the host.  
how/where these are actually done, not sure... cuz it should be in a platform independent way...


</PRE>

<H3>Terminology</H3>


<UL>
<LI>ENC: External Node Classifier.  One possible methods to organize node (client host) data.  <BR>
    Other possibility include Hiera (for hierachy) and LDAP backed.
	<OL>
	<LI>ENC is a script written in any lang.  output is YAML.
	<LI>only assign classes, top-scope var, and env for the node.
	</OL>
<LI>Hiera: a way to organize node variable and separate it from data in modules.  
	<OL>
	<LI>Optional, activate it in hiera.yaml.  This define where all the places where YAML hierarchi are sourced (/etc/puppet/data/hiera, and the order sequence.
	<!-- nx has one host-fqdn yaml per node lister under each site, a common.yaml for site and then nx wide -->
	<LI>facts are case sensitive in hiera and template
	<LI>http://docs.puppetlabs.com/hiera/1
	<LI>
	</OL>
<LI>YAML: typical output format for puppet.
	<OL>
	<LI>YAML files start with three dashes (---); 
	<LI>use colons (:) to separate parameters from values, 
	<LI>hyphens (-) to separate multiple values (arrays).
	</OL>

<LI>
	<OL>
	<LI>
	<LI>
	</OL>
<LI>
<LI>

</UL>

<PRE>
</PRE>
<BR><BR>


<H3>Commands/Troubleshooting</H3>

<PRE>
# run on single machine


puppet apply -e 'notify { "I am $fqdn and have $processorcount CPU/core": }'

puppet agent		# this is the main daemon process on node, will be daemonized by def, 
			# but pull/cron mechanism don't need this agent to be running.
puppet agent -t		# should be able to see if environment is set to dev, test, or prd.  
puppet agent --no-daemonize --onetime --noop --test -v   # ? help get some info of what a run would do


puppet help		# list puppet subcommands
puppet status local	# YAML output of whether puppet is running and version info
puppet describe --list	# list of puppet resource types.  eg augeas, computer, sshkey, package...
			# good place to find out what clause and params are usable in .pp files

puppet describe sshkey

facter domain 		# depends on DNS reverse record
facter fqdn


</PRE>


<H3>PuppetDB</H3>

<pre>
install as puppet module
...
</pre>

<H3>Examples</H3>

<H4>
Check for OS and version when applying NTP config
</H4>

NTP definition is defined for the site in <BR>
/etc/puppet/data/hiera/usa/common.yaml :: <BR>

<PRE class="cf">
ntp_servers:
      - 'time1.us.nx.com'
      - 'time2.us.nx.com'
      - 'time1.eu.nx.com'
</PRE>

Then, in the puppet code, it checks for the OS and version, and decides how to apply these changes accordingly.  
Note where $osname and $osmajor are checked.
This kind of check is coded in  each class, eg srv_oracle, httpd, cups, etc. 
<BR>

/etc/puppet/environment/prd/modules/common/ntp/manifests/params.pp ::

<!-- PRE class="code" would set bg to gray in addition to just a box frame of "cf" -->
<PRE class="cf">
class ntp::params($ntp_servers='', $ntp_allow_stepping='')
{
  $osmajor = $core::params::osmajor
  $osfamily = $core::params::osfamily

  if empty($ntp_servers) {
    fail('No NTP servers specified (hiera var ntp_servers)')
  }

  case $ntp_allow_stepping {
    'true','false': {}
    default: { fail("Invalid value for ntp_allow_stepping : ${ntp_allow_stepping}. Must be true or false") }
  }

  case $core::params::osname {
    'rhel','centos': {
      $service_name = 'ntpd'
      $conf_file    = '/etc/ntp.conf'
      $conf_file_template = "ntp.conf.${osfamily}.erb"
      $step = $ntp_allow_stepping ? { 'true' => '-x', 'false' => '' }

      case $osmajor {
        '5': {
          $ntp_options = strip("-u ntp:ntp -p /var/run/ntpd.pid ${step}")
          $package_list = 'ntp'
          $has_separate_ntpdate = 'false'
        }
        '6': {
          $ntp_options = strip("-u ntp:ntp -p /var/run/ntpd.pid ${step}")
          $package_list = ['ntp','ntpdate']
          $has_separate_ntpdate = 'true'
        }

        default: {
          fail("Module ${module_name} does not support ${::operatingsystem} ${::operatingsystemrelease}")
        }
      }
    }
    default: {
      fail("Module ${module_name} does not support ${::operatingsystem}")
    }
  }
}
</PRE>

<H4>
    Excluding specific app from installation
</H4>

/etc/puppet/environment/prd/modules/common/core/manifest/package_blacklist.pp 
defines the code on how to handle blacklist, while <BR>
/etc/puppet/data/hera/common/common.yaml 
is an example of actual usage of declaring what is to be blacklisted.  in this case, all servers (common) across all classes/sites exclude the redhat annoyware:

<PRE class="cf">
core_package_blacklist_rhel:
      - 'subscription-manager'
</PRE>


<H4>
Explicitly call out and include other classes:
</H4>

<BR>
<PRE class="cf">
# this class implements a generic server
class srv_generic{
  include srv_common
  class {'core::puppet_facts': puppet_class => $module_name}
}

## the srv_common has a large list of include.
## for server conversion from CFEngine into puppet.
## may want to create a srv_bare that has minimal settings
## but then again, the basic site settings should be okay even if they were diff than pre-migration settings. 
</PRE>

<H4>
Mounts
</H4>


Define a list of commont mount points, location and options for the site at <BR>
/etc/puppet/data/hiera/usem/common.yaml :: <BR>
<PRE class="cf">
---
mountfs_default_options:
  'nfs1.usa.nx.com.net_nfs': 'intr,tcp,rw,rsize=32768,wsize=32768,nfsvers=3,_netdev'
  'nfs2.usa.nx.com.net_nfs': 'intr,udp,rw,nfsvers=2,_netdev'

mountfs_mountpoints:
  'homedirs':
    mountpoint: '/nfs/nfshome'
    group: 'universal'
    type: 'static'
    source: 'nfs://nfs1.usa.nx.com/ifs/usa/nfshome'
  'oldhomedirs':
    mountpoint: '/nfs/oldhome'
    group: 'oldhome'
    type: 'static'
    source: 'nfs://netapp.nx.com/vol/oldhome'
  'ora_global_nfs':
    mountpoint: '/ora_global_nfs'
    group: 'srv_oracle'
    type: 'autofs'
    source: 'nfs://nfs2.usa.nx.com/ifs/usa/sync/ora_core'
    # the ora_global_nfs mount uses an existing class called srv_oracle, so 
    # any server defined in this class will get get this mount included.

# this below means all host on this site (using this common.yaml) will mount the "universal" group, 
# no need to define them in the host-specific hiera file.
mountfs_mount_by_group:
  - 'universal'
</PRE>

Then for machines that need to use such pre-defined mount points, at <BR>
/etc/puppet/data/hiera/usa/host/appsvr002.yaml :: <BR>

<PRE class="cf">
---
# define one off mounts manually, could be nfs or local hd
mountfs_mountpoints:
  appsvr002_apps_splunk:
    mountpoint: '/opt/splunk'
    type: 'static'
    source: 'ext4:///dev/mapper/vg_apps-lv_splunk'
    options: 'defaults'


mountfs_mount_by_group:
  - 'oldhome'
  # no need to spell out the inclusing of the 'universal' group mount

</PRE>

<H4>
Realize virtual classes
</H4>

Convention to use <TT>@</TT> for virtual class name
<BR>
<TT>realize</TT> is to instantiate/materialize the virtual class
<BR>


/etc/puppet/environment/prd/modules/common/core/manifests/local_users.pp ::

<PRE class="cf">
class core::local_users
{
  $core_local_users=hiera_array('core_local_users',[])

  if size($core_local_users) > 0 {
    realize( User[$core_local_users] )
  }

  $set_oracle_password=hiera('core_local_users_oracle_reset_password','true')
  case $set_oracle_password {
    'true': { $oracle_password='!!' }
    'false': { $oracle_password=undef }
    default: { fail("Module ${module_name}: 'core_local_users_oracle_reset_password' must be set to 'true' or 'false'") }
  }

  @user {'oracle':
    ensure   => present,
    uid      => hiera('core_local_users_oracle_uid','666'),
    gid      => hiera('core_local_groups_dba_gid','666'),
    home     => '/u01/home/oracle',
    shell    => '/bin/ksh',
    password => $oracle_password,
    require  => [ Group['dba'], Package['ksh'] ]
  }

  # additional @user can be declared here
}
</PRE>

/etc/puppet/environment/prd/modules/common/srv_oracle/manifests/init.pp ::
<PRE class="cf">
class srv_middleware_oracle {
  $osmajor = $core::params::osmajor
  $default_vg_name = $core::params::default_vg_name
  case $::operatingsystem {
    'RedHat': {}
    'CentOS': {}
    default: {fail("Module ${module_name} does not support ${::operatingsystem}") }
  }
  # ...
  realize(User['oracle'])
  realize(Group['dba'])
}
</PRE>
    
<H3>Related tools</H3>

<UL>
<LI>mrepo/mcollective
<LI>platform
<LI>foreman
<LI><A HREF="development.html#git">git</A>
</UL>

<H3>Reference</H3>

<UL>
<LI>Uphill, Thomas (2014-07-16). Mastering Puppet (p. 40). Packt Publishing. Kindle Edition. 
<LI><A HREF="http://tba/">tba</A>
<LI><A HREF="cfengine">cfengine</A>
</UL>

<BR><BR> <HR> 

<div class="quote">
Puppet (OpenSource) version 3.7.4 <BR>
Last Updated: 2015.02.26 <BR>
</div>

<HR> <BR><BR>


<A NAME="cc"></A>
<A NAME="CreativeCommon"></A>
<H3>Copyright info about this work
</H3>    

<p>
This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/">Creative Commons Attribution-NonCommercial-ShareAlike2.5 License</a>.
       <!--/Creative Commons License-->
       <!-- <rdf:RDF xmlns="http://web.resource.org/cc/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
       <Work rdf:about="">
       <license rdf:resource="http://creativecommons.org/licenses/by-nc-sa/2.5/" />
            <dc:title>Pocket Sys Admin Survival Guide</dc:title>
            <dc:date>2005</dc:date>
            <dc:description>A series of concise system administration notes</dc:description>
            <dc:creator><Agent><dc:title>Tin Ho</dc:title></Agent></dc:creator>
            <dc:rights><Agent><dc:title>Tin Ho</dc:title></Agent></dc:rights>
            <dc:type rdf:resource="http://purl.org/dc/dcmitype/Text" />
            <dc:source rdf:resource="http://tin6150.github.io/psg/" />
            </Work>
            <License rdf:about="http://creativecommons.org/licenses/by-nc-sa/2.5/"><permits rdf:resource="http://web.resource.org/cc/Reproduction"/>
                                       <permits rdf:resource="http://web.resource.org/cc/Distribution"/>
                                       <requires rdf:resource="http://web.resource.org/cc/Notice"/><requires rdf:resource="http://web.resource.org/cc/Attribution"/>
                                       <prohibits rdf:resource="http://web.resource.org/cc/CommercialUse"/>
                                       <permits rdf:resource="http://web.resource.org/cc/DerivativeWorks"/><requires rdf:resource="http://web.resource.org/cc/ShareAlike"/>
            </License>
            </rdf:RDF> -->


<Strong>Pocket Sys Admin Survival Guide</Strong>: for content that I wrote, (<a
 href="http://creativecommons.org/licenses/by-nc-sa/2.5/">CC</a>)  
 <a href="http://creativecommons.org/learnmore"> <i>some rights reserved</i></a>.  
 2005,2012 Tin Ho [ tin6150 (at) gmail.com ]  <br>
 
Some contents are "cached" here for easy reference. Sources include man pages, 
vendor documents, online references, discussion groups, etc. Copyright of those 
are obviously those of the vendor and original authors.  I am merely caching them here for quick reference and avoid broken URL problems.
</p>

  <br><br>


<h3>Where is PSG hosted these days?</h3>
  <div id="psg-url">
  <a href="http://tin6150.github.io/psg/psg2.html">http://tin6150.github.io/psg/psg2.html</a> 
  This new home page at github<br>
  
  <A HREF="http://tiny.cc/tin6150"> 
  http://tiny.cc/tin6150/</A>
  New home in 2011.06.  <BR>



<A HREF="http://tin6150.s3-website-us-west-1.amazonaws.com/psg.html">http://tin6150.s3-website-us-west-1.amazonaws.com/psg.html</A> 
(coming soon)
<BR>
<a href="ftp://read:only@sn.is-a-geek.com/psg/psg.html">ftp://sn.is-a-geek.com/psg/psg.html</a> 
My home "server".  Up sporadically.
<BR>

<!--
Other caches in decreasing order of update frequency:  <BR>

<A HREF="http://tin6150.github.io/psg/psg.html">
http://tin6150.github.io/psg/psg.html
</A> 
(Google site, they are changing their policy and I may not be update these pages in the near future.  Last updated 2009-10-10)<BR>
-->


<A HREF="http://tin6150.github.io/psg/psg.html">http://tin6150.github.io/psg/psg.html</A> <BR>
<A HREF="http://www.fiu.edu/~tho01/psg/psg.html">http://www.fiu.edu/~tho01/psg/psg.html</A> (no longer updated as of 2007-05)<BR>

</div>       
      
      
      
      
      
      
      
      
      
      
      
      
  </div> <!-- #content -->
  
  
  <div id="tailer">      
            <div class="noicon">
            <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/">
                <img alt="Creative Commons License" src="http://creativecommons.org/images/public/somerights20.png"></a>
            <a href="http://jigsaw.w3.org/css-validator/check/referer">
                <img style="border:0;width:88px;height:31px"
                    src="http://jigsaw.w3.org/css-validator/images/vcss-blue"
                    alt="Valid CSS!">
            </a>
            <a href="http://validator.w3.org/check?uri=referer">
                <img src="http://www.w3.org/Icons/valid-html401" alt="Valid HTML 4.01 Strict" height="31" width="88">
            </a>
        </div>
  </div> <!-- #tailer -->

  
  
  
  
  <div id="footer"> (CC 2012) Some Rights Reserved.</div>
  
</div> <!-- closes wrapper --> 
</body>
</html>
