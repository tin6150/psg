<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
 


   
<!--  xhtml format, hw6 (tables) had to use transitional instead of strict dtd.  -->    
<!--
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">


the one below for strict html:
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

sttrict xhtml:

-->





<!--  
CSS validator: http://jigsaw.w3.org/css-validator/#validate_by_uri
HTML validator: http://validator.w3.org/
-->    
    
<head>
	<title>Sys Admin Pocket Survival Guide</title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
        <link rel="stylesheet" href="psg2.css"                type="text/css" media="screen">
        <link rel="stylesheet" href="psg-table.css"           type="text/css">
        <link rel="stylesheet" href="psg2-links-icons.css"    type="text/css">
        <link rel="stylesheet" href="psg-positioning.css"     type="text/css">
        <link rel="stylesheet" href="psg-print.css" type="text/css" media="print">
</head>

    
<body>
  <div id="fixie"> <!-- add a fixed position example for css final project.   potentially use to place ad, which will appear like a 3rd column on right -->
          <div id="one"   class="skinny"><a href="plug/plug.html"><img src="plug/nema-5-20R-drawing.gif" alt="nema5pic" width="100" height="100"></a></div>
          <div id="two"   class="skinny"><a href="fig/unixoid_hell.gif"><img src="fig/unixoid_hell.gif"  alt="vi-hell"   width="100" height="77" ></a></div>
          <div id="three" class="skinny"><a href="fig/Assistant.gif"><img    src="fig/Assistant.gif"     alt="clippie"   width="100" height="77" ></a></div>
          <div id="four"  class="skinny"><!-- empty for now --></div>
  </div> <!-- closes #fixie -->

    
<div id="wrapper">
  <div id="header">
    <div id="title">Sys Admin Pocket Survival Guide</div>
    <div id="sub-title">A Quick Reference Guide for Sys Admins with Alzeimer :)</div>
  </div> <!-- closes header -->
  
  <div id="navigation">
      <!-- the replace was not inside hightlight area, but whole page, finc and put back some strong and em in doc...-->
   <!--  strong, em, h5, or div are not allowed to be nested inside ul !!  -->
       <div class="azul">Unix</div>
	<ul>
        <li> <a href="sul>.html">Solaris</a></li>
        <li> <a href="linux.html">Linux</a></li>
        <li> <a href="hpux.html">HP-UX</a> and <br>
                <a href="hpux.supl.html">supplement</a></li>
        <li> <a href="aix.html">AIX</a> and <br>
                <a href="aix_cd_catalog.html">AIX CD catalog</a><br></li>
        <li> <a href="irix.html">Irix</a></li>
        <li> <a href="dos.html">Windows</a></li>
        <li> <a href="apple.html">Apple Mac</a></li>
	</ul>

        <div class="azul">Storage</div>
	<ul>
        <li> <a href="netapp.html">NetApp</a></li>
        <li> <a href="emc.html">EMC SAN - Clariion</a></li>
        <li> <a href="emcCelerra.html">EMC NAS - Celerra</a></li>
        <li> <a href="isilon.html">Isilon</a></li>     
        <li> <a href="fs.html">Unix File System</a></li>
	</ul>

        <div class="azul">Big Data</div>
	<ul>
        <li> <a href="lsf.html">LSF, PBS/Torque, LSF.</a></li>
        <li> <a href="mpi.html">MPI, PVM</a></li>
        <li> <a href="sci-file.html">Science File Format/Info</a></li>
        <li><a href="sci-app.html">Sci-App</a></li>
	</ul>
            
      
        <div class="azul">Unix Dev</div>
	<ul>
  	<li><a href="development.html">compilers, etc</a></li>
  	<li><a href="shellScript.txt">sh/bash, csh/tcsh</a></li>
  	<li><a href="awk.txt">AWK</a></li>
  	<li><a href="perl.html">Perl</a></li>
  	<li><a href="python.html">Python</a></li>
  	<li><a href="php.txt">PHP</a></li>
  	<li><a href="javascript_eg.html">javascript_eg</a></li>
   	<li>gcc</li>
  	<li><a href="gdb.html">gdb</a></li>
   	<li>java</li>
   	<li>rcs, cvs, p4, subversion</li>
	<li><a href="vi.html">vi</a></li> 
	</ul>

        <div class="azul">Network</div>
	<ul>
        <li> <a href="net.html">Network</a></li>
        <li> <a href="infiniband.html">InfiniBand</a><br></li>
        <li> <a href="acopia.html">Acopia</a></li>
	</ul>

        <div class="azul">Misc</div>
	<ul>
        <li> <a href="ldap.html">LDAP</a><BR></li>
        <li> <a href="admin.html">General Unix Sys Admin </a></li>
        <li> <a href="tool.html">Sys Admin tools and performance tuning</a></li>
        <li> <a href="vnc.html">VNC, X Emulation</a></li>
        <li> <a href="backup.html">Unix backup</a></li>
        <li> <a href="general_unix.html">Generic Unix Commands</a></li>
        <li> <a href="veritas.html">Veritas</a></li>
        <li> <a href="legato.html">Legato Networker</a></li>
        <li> <a href="mysql.html">MySQL</a></li>
        <li> <a href="html.txt">HTML tags</a></li>
        <li> <a href="wiki.html">WiKi tags</a></li>
        <li> <a href="3rdParty">3rd Party and Vendor Docs Cache</a></li>
	</ul>

        <div class="azul">IMHO</div>
	<ul>
        <li> <a href="monitor.html">Network monitoring tool review</a></li>
        <li> <a href="netArch.html">Network Architecture Approaches</a></li>
        <li> <a href="docPlatform.html">Documentation platform</a></li>
	</ul>

        <div class="azul">Prod Review</div>
	<ul>
        <li><a href="termSvr.html">Terminal (Serial Console) Servers</a></li>
        <li><a href="ent_prod.html">Enterprise Products</a></li>
        <li><a href=""></a></li>
        <li> &nbsp; </li>
	</ul>
            
  </div> <!-- closes #navigation -->


  <!-- ########################################################## -->
  <!-- ########################################################## -->
  
  <div id="content">

      <p>
  
  <H2>Postfix</H2>
<PRE>
</PRE>
<p>

<H3></H3>

<div class="quote">
</div>

~~

<PRE>
</PRE>
<H3>Commands/Troubleshooting</H3>


<pre>
config files in /etc/postfix
	main.cf
logs in /var/log/maillog

postfix reload		# after doing changes to config files
postfix flush 		# churn thru the mail backlog ==? postqueue -f
mailq			# check the mailq  == postqueue -p
postsuper -d 6DF3D6A444 # remove a specific mail in the queue with the specified id
postsuper -d deferred   # remove all deferred mail (but not other errors).   CAREFUL!
postsuper -d ALL        # remove all queue mail (all those shown by mailq).  VERY CAREFUL!


postconf -d    # show default param for postfix 
postconf -d  | grep mydomain
postconf -d  | grep myhost 

postconf -n             # to find out what settings are overruled by your main.cf. , 
                        # show what postfix parsed/took out of config file
postconf mail_version   # To find out what Postfix version you have, execute the command 

</pre>

    
<H3></H3>

<PRE>
address rewritting bible :)

http://www.postfix.org/ADDRESS_REWRITING_README.html#masquerade

mascarade is to hide some early portion of the domain name, 
eg strip na.nova.com to nova.com


/etc/postfix/canonical
	# change domain address in both sender and recipient
	# main for username to first.last, 
	# but should be able to specify domain as in eg of sender-canonical
	# postmap ./canonical
	# postmap -q "string" ./canonical # ??
	# eg:
	@local          @lbl.gov
	@beagle         @lbl.gov
	@beagle.local   @lbl.gov




/etc/postfix/sender-canonical		# sender only, need to enable clause in main.cf.  
	# eg content:
	@local          @lbl.gov
	@beagle         @lbl.gov
	@beagle.local   @lbl.gov
	# eg content 2:
	@local		@na.grumpy.com
	@headnode	@na.grumpy.com
	@headnode.local	@na.grumpy.com


/etc/postfix/recipient-canonical	# eg:
	root@na.grumpy.com	root
	@mycluster.local	@na.grumpy.com
	eg2: 
	root@beagle.lbl.gov    root
	@gretadev              @lbl.gov
	@beagle                @lbl.gov
	@beagle.local          @lbl.gov



after update to the file, recreate hash (or dbm) as:
sudo postmap /etc/postfix/sender-canonical

Specify dbm instead of hash if your system uses dbm files instead of db files. 
To find out what lookup tables Postfix supports, use the command 
"postconf -m".
But more importantly, see whether main.cf refer to hash:/etc/postfix/filename or dbm

Execute the command "postmap /etc/postfix/relay_recipient" 
whenever you change the relay_recipients table.
	eg of relay-canonical (tailing x means "checked" to allow domain to relay):
	@lbl.gov         x

	# added additional domain on 2020.0718, 
        # but not likely needed, as all email, even those to gmail.com, were forwarded to onward smtp server
	@berkeley.edu    x
	@es.net          x
	@nersc.gov       x



Execute the command "postmap /etc/postfix/transport" whenever you change the transport table.


</PRE>

<H3>main.cf</H3>

Example for cluster head node (which act as relay host for all compute nodes):

<PRE class=cf>

mydestination = $mydomain, $myhostname, localhost.$mydomain
mynetworks = 10.10.8.0/24, 127.0.0.0/8, 192.168.2.0/24
inet_interfaces = all
append_dot_mydomain = no
sender_canonical_maps = hash:/etc/postfix/sender-canonical
recipient_canonical_maps = hash:/etc/postfix/recipient-canonical
##
relayhost = smtp.na.skinforum.org
mydomain = na.skinforum.org
myorigin = headnode.na.skinforum.org

</PRE>


Example for node sending mail to be relayed.
SASL auth is turned off, ok only for private network with no possible outside access.
<!-- CF_BK/beagle_gretaDev/postfix/client_main.cf -->

<PRE class=cf>
mydestination = $mydomain, $myhostname, localhost.$mydomain   
relayhost = 10.2.3.4:25
mydomain = gretadev 
mynetworks = 127.0.0.0/8 
smtp_sasl_auth_enable = no
smtp_use_tls = no                # DOE special anyway :p
</PRE>

<H2>Ref</H2>

interesting command and script to delete deferred mail.
<A HREF="http://www.cyberciti.biz/tips/howto-postfix-flush-mail-queue.html">
http://www.cyberciti.biz/tips/howto-postfix-flush-mail-queue.html</A>
<BR>
<BR>

<PRE>
</PRE>


<BR><BR>
<HR>
<BR><BR>

<A NAME="cc"></A>
<A NAME="CreativeCommon"></A>
<H3>Copyright info about this work
</H3>    

<p>
This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/">Creative Commons Attribution-NonCommercial-ShareAlike2.5 License</a>.
       <!--/Creative Commons License-->
       <!-- <rdf:RDF xmlns="http://web.resource.org/cc/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
       <Work rdf:about="">
       <license rdf:resource="http://creativecommons.org/licenses/by-nc-sa/2.5/" />
            <dc:title>Pocket Sys Admin Survival Guide</dc:title>
            <dc:date>2005</dc:date>
            <dc:description>A series of concise system administration notes</dc:description>
            <dc:creator><Agent><dc:title>Tin Ho</dc:title></Agent></dc:creator>
            <dc:rights><Agent><dc:title>Tin Ho</dc:title></Agent></dc:rights>
            <dc:type rdf:resource="http://purl.org/dc/dcmitype/Text" />
            <dc:source rdf:resource="http://tin6150.github.io/psg/" />
            </Work>
            <License rdf:about="http://creativecommons.org/licenses/by-nc-sa/2.5/"><permits rdf:resource="http://web.resource.org/cc/Reproduction"/>
                                       <permits rdf:resource="http://web.resource.org/cc/Distribution"/>
                                       <requires rdf:resource="http://web.resource.org/cc/Notice"/><requires rdf:resource="http://web.resource.org/cc/Attribution"/>
                                       <prohibits rdf:resource="http://web.resource.org/cc/CommercialUse"/>
                                       <permits rdf:resource="http://web.resource.org/cc/DerivativeWorks"/><requires rdf:resource="http://web.resource.org/cc/ShareAlike"/>
            </License>
            </rdf:RDF> -->


<Strong>Pocket Sys Admin Survival Guide</Strong>: for content that I wrote, (<a
 href="http://creativecommons.org/licenses/by-nc-sa/2.5/">CC</a>)  
 <a href="http://creativecommons.org/learnmore"> <i>some rights reserved</i></a>.  
 2005,2012 Tin Ho [ tin6150 (at) gmail.com ]  <br>
 
Some contents are "cached" here for easy reference. Sources include man pages, 
vendor documents, online references, discussion groups, etc. Copyright of those 
are obviously those of the vendor and original authors.  I am merely caching them here for quick reference and avoid broken URL problems.
</p>

  <br><br>


<h3>Where is PSG hosted these days?</h3>
  <div id="psg-url">
  <a href="http://tin6150.github.io/psg/psg2.html">http://tin6150.github.io/psg/psg2.html</a> 
  This new home page at github<br>
  
  <A HREF="http://tiny.cc/tin6150"> 
  http://tiny.cc/tin6150/</A>
  New home in 2011.06.  <BR>



<A HREF="http://tin6150.s3-website-us-west-1.amazonaws.com/psg.html">http://tin6150.s3-website-us-west-1.amazonaws.com/psg.html</A> 
(coming soon)
<BR>
<a href="ftp://read:only@sn.is-a-geek.com/psg/psg.html">ftp://sn.is-a-geek.com/psg/psg.html</a> 
My home "server".  Up sporadically.
<BR>

<!--
Other caches in decreasing order of update frequency:  <BR>

<A HREF="http://tin6150.github.io/psg/psg.html">
http://tin6150.github.io/psg/psg.html
</A> 
(Google site, they are changing their policy and I may not be update these pages in the near future.  Last updated 2009-10-10)<BR>
-->


<A HREF="http://tin6150.github.io/psg/psg.html">http://tin6150.github.io/psg/psg.html</A> <BR>
<A HREF="http://www.fiu.edu/~tho01/psg/psg.html">http://www.fiu.edu/~tho01/psg/psg.html</A> (no longer updated as of 2007-05)<BR>

</div>       
      
      
      
      
      
      
      
      
      
      
      
      
  </div> <!-- #content -->
  
  
  <div id="tailer">      
            <div class="noicon">
            <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/">
                <img alt="Creative Commons License" src="http://creativecommons.org/images/public/somerights20.png"></a>
            <a href="http://jigsaw.w3.org/css-validator/check/referer">
                <img style="border:0;width:88px;height:31px"
                    src="http://jigsaw.w3.org/css-validator/images/vcss-blue"
                    alt="Valid CSS!">
            </a>
            <a href="http://validator.w3.org/check?uri=referer">
                <img src="http://www.w3.org/Icons/valid-html401" alt="Valid HTML 4.01 Strict" height="31" width="88">
            </a>
        </div>
  </div> <!-- #tailer -->

  
  
  
  
  <div id="footer"> (CC 2012) Some Rights Reserved.</div>
  
</div> <!-- closes wrapper --> 
</body>
</html>
<!-- vim: noexpandtab tabstop=8 
-->
